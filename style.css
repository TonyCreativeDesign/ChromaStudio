/* style.css (fichier complet modifié) */
/* ==========================================================================
1. DESIGN SYSTEM & GLOBAL STYLES
========================================================================== */
:root{
--font-sans: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
--font-mono: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;

--ease-out-quad: cubic-bezier(.25,.46,.45,.94);
--duration-fast: 150ms;
--duration-medium: 300ms;

--z-index-modal: 1000;
--z-index-header: 500;
--z-index-draggable: 100;
--z-index-toast: 900;
--z-index-drawer: 850;

--shadow-small: 0 1px 2px rgba(0,0,0,.05), 0 1px 3px rgba(0,0,0,.1);
--shadow-medium: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -1px rgba(0,0,0,.06);
--shadow-large: 0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05);

--topbar-height: 56px;

/* Touch targets */
--tap-min: 44px;
}

[data-theme="light"]{
--color-bg-primary:#F9FAFB; --color-bg-secondary:#FFFFFF; --color-bg-tertiary:#F3F4F6;
--color-text-primary:#111827; --color-text-secondary:#4B5563; --color-text-muted:#6B7280;
--color-border-primary:#E5E7EB; --color-border-secondary:#D1D5DB;
--color-accent-primary:#3B82F6; --color-accent-primary-text:#FFFFFF; --color-accent-secondary:#1D4ED8;
--color-focus-ring:rgba(59,130,246,.5); --color-swatch-text:#FFFFFF;
}
[data-theme="dark"]{
--color-bg-primary:#111827; --color-bg-secondary:#1F2937; --color-bg-tertiary:#374151;
--color-text-primary:#F9FAFB; --color-text-secondary:#D1D5DB; --color-text-muted:#9CA3AF;
--color-border-primary:#374151; --color-border-secondary:#4B5563;
--color-accent-primary:#60A5FA; --color-accent-primary-text:#111827; --color-accent-secondary:#93C5FD;
--color-focus-ring:rgba(96,165,250,.6); --color-swatch-text:#FFFFFF;
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
font-family:var(--font-sans);
background:var(--color-bg-primary);
color:var(--color-text-primary);
font-size:14px;
line-height:1.5;
-webkit-font-smoothing:antialiased;
-moz-osx-font-smoothing:grayscale;
transition: background var(--duration-medium) var(--ease-out-quad), color var(--duration-medium) var(--ease-out-quad);
overflow:hidden; /* évite double scroll, surtout en iframe */
}

/* Skip link */
.skip-link{
position:absolute;
left:12px;
top:12px;
padding:.5rem .75rem;
border-radius:.5rem;
background:var(--color-bg-secondary);
border:1px solid var(--color-border-primary);
color:var(--color-text-primary);
text-decoration:none;
transform:translateY(-200%);
transition:transform var(--duration-fast) var(--ease-out-quad);
z-index: calc(var(--z-index-header) + 5);
}
.skip-link:focus{transform:translateY(0)}

/* ==========================================================================
2. SHELL, TOPBAR, LAYOUT
========================================================================== */
.app-shell{
/* IMPORTANT: body est overflow:hidden => il faut CONTRAINDRE la hauteur de l'app,
   sinon le contenu est "coupé" sans scroll. */
height:100vh;     /* fallback */
height:100svh;    /* iOS UI stable */
height:100dvh;    /* viewport dynamique */
min-height:100dvh;
min-height:100svh;

width:100%;
display:flex;
flex-direction:column;
}

.topbar{
min-height:var(--topbar-height);
height:var(--topbar-height);
display:flex;
align-items:center;
justify-content:space-between;
gap:.75rem;
padding:.5rem 1rem;
background:var(--color-bg-secondary);
border-bottom:1px solid var(--color-border-primary);
position:sticky;
top:0;
z-index:var(--z-index-header);
}

.topbar-left, .topbar-right{
display:flex;
align-items:center;
gap:.5rem;
min-width:0;
}

.brand{
display:flex;
flex-direction:column;
line-height:1.05;
min-width:0;
}
.brand-title{
font-weight:800;
letter-spacing:.01em;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
}
.brand-subtitle{
font-size:.75rem;
color:var(--color-text-muted);
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
}

.app-layout{
flex:1;
min-height:0; /* essentiel pour scroll internes */
height:100%;  /* IMPORTANT: contraint réellement la zone centrale */
width:100%;
display:grid;
grid-template-columns: clamp(240px,24vw,300px) 1fr clamp(260px,26vw,340px);
overflow:hidden;
}

/* CHANGEMENT: autorise le scroll interne des enfants grid (évite le clipping) */
.app-layout > *{
min-height:0;
}

/* ==========================================================================
3. COLUMNS (SIDEBARS & MAIN)
========================================================================== */
.sidebar{
background:var(--color-bg-secondary);
display:flex;
flex-direction:column;
overflow:auto;
-webkit-overflow-scrolling:touch;
padding:1rem;
gap:1rem;
min-height:0;
max-width:100%;
}
.sidebar-left{border-right:1px solid var(--color-border-primary)}
.sidebar-right{border-left:1px solid var(--color-border-primary)}

.main-content{
display:flex;
flex-direction:column;
overflow:hidden;
min-width:0;
/* CHANGEMENT: requis en grid pour que les enfants scrollables puissent réellement scroller */
min-height:0;
}

.main-header{
padding:.5rem 1rem;
border-bottom:1px solid var(--color-border-primary);
display:flex;
justify-content:space-between;
align-items:center;
flex-wrap:wrap;
gap:.5rem;
flex-shrink:0;
background:var(--color-bg-primary);
}

.palette-container{
flex:1;
min-height:0;
display:grid;
grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
gap:1rem;
padding:1rem;

/* Scroll zone */
overflow:auto;
-webkit-overflow-scrolling:touch;
touch-action: pan-y;

/* Confort visuel (évite “jump” quand la scrollbar apparaît) */
scrollbar-gutter: stable;

/* Limite la propagation du scroll (utile en iframe / drawers) */
overscroll-behavior: contain;
}

/* Focus visible pour scroll clavier (tabindex sur #palette-container) */
.palette-container:focus-visible{
outline:2px solid var(--color-focus-ring);
outline-offset:-2px;
border-radius:.75rem;
}

/* ==========================================================================
4. DRAWERS (OFF-CANVAS) + OVERLAY
========================================================================== */
.drawer-overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,.55);
z-index:var(--z-index-drawer);
opacity:0;
pointer-events:none;
transition:opacity var(--duration-medium) var(--ease-out-quad);
}
.drawer-overlay:not(.hidden){
opacity:1;
pointer-events:auto;
}

/* Le bouton topbar n'est utile qu'en mode drawer (activé via media queries) */
.topbar-btn{display:none}

/* RIGHT sidebar devient drawer à <=1200px (tablette/desktop étroit) */
@media (max-width:1200px){
.app-layout{grid-template-columns: clamp(240px,30vw,320px) 1fr;}
.topbar-btn{display:inline-flex}

.sidebar-right{
position:fixed;
top:var(--topbar-height);
right:0;
bottom:0;
width:min(92vw, 380px);
transform:translateX(105%);
transition:transform var(--duration-medium) var(--ease-out-quad);
z-index: calc(var(--z-index-drawer) + 1);
border-left:1px solid var(--color-border-primary);
box-shadow:var(--shadow-large);
}
.sidebar-right.is-open{transform:translateX(0)}
}

/* LEFT sidebar devient drawer à <=768px (mobile/tablette) */
@media (max-width:768px){
.app-layout{grid-template-columns: 1fr;}
.sidebar-left{
position:fixed;
top:var(--topbar-height);
left:0;
bottom:0;
width:min(92vw, 380px);
transform:translateX(-105%);
transition:transform var(--duration-medium) var(--ease-out-quad);
z-index: calc(var(--z-index-drawer) + 1);
border-right:1px solid var(--color-border-primary);
box-shadow:var(--shadow-large);
}
.sidebar-left.is-open{transform:translateX(0)}
}

/* Ajustement palette sur petit écran */
@media (max-width:480px){
.palette-container{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}
}

/* ==========================================================================
5. CORE COMPONENTS
========================================================================== */
.panel{
background:var(--color-bg-secondary);
border-radius:.75rem;
padding:1rem;
border:1px solid transparent;
}
.sidebar-left .panel{background:var(--color-bg-primary)}

.panel-title{
font-size:.8rem;
font-weight:700;
color:var(--color-text-secondary);
margin-bottom:1rem;
text-transform:uppercase;
letter-spacing:.06em
}
.panel-subtitle{
font-size:.8rem;
font-weight:700;
color:var(--color-text-secondary);
margin:.75rem 0 .5rem
}

/* Buttons & Icon buttons: targets tactiles */
.button{
min-height:var(--tap-min);
display:inline-flex;
align-items:center;
justify-content:center;
gap:.5rem;
font-weight:700;
font-size:.875rem;
padding:.5rem .875rem;
border-radius:.6rem;
border:1px solid var(--color-border-secondary);
background:var(--color-bg-tertiary);
color:var(--color-text-primary);
cursor:pointer;
transition:all var(--duration-fast) var(--ease-out-quad);
text-decoration:none;
white-space:nowrap;
}
.button:hover:not(:disabled){background:var(--color-border-primary)}
.button:disabled{opacity:.5;cursor:not-allowed}
.button.primary{
background:var(--color-accent-primary);
border-color:var(--color-accent-primary);
color:var(--color-accent-primary-text)
}
.button.primary:hover:not(:disabled){
background:var(--color-accent-secondary);
border-color:var(--color-accent-secondary)
}
.button.full-width{width:100%}

.icon-button{
min-width:var(--tap-min);
min-height:var(--tap-min);
background:none;
border:none;
padding:.5rem;
border-radius:999px;
color:var(--color-text-secondary);
cursor:pointer;
display:inline-flex;
align-items:center;
justify-content:center;
transition: background var(--duration-fast), color var(--duration-fast);
}
.icon-button:hover{background:var(--color-bg-tertiary); color:var(--color-text-primary)}

.form-group{margin-bottom:.75rem}
.form-group:last-child{margin-bottom:0}
.form-group label{
display:block;
font-size:.8rem;
font-weight:600;
color:var(--color-text-secondary);
margin-bottom:.25rem
}

/* 3 colonnes si possible, sinon wrap automatiquement */
.form-group-grid{
display:grid;
grid-template-columns:repeat(3, minmax(0, 1fr));
gap:.5rem;
}
@media (max-width:520px){
.form-group-grid{grid-template-columns:repeat(2, minmax(0, 1fr));}
}

input[type="text"],input[type="number"],select{
min-height:var(--tap-min);
width:100%;
padding:.5rem .75rem;
font-size:.875rem;
background:var(--color-bg-primary);
border:1px solid var(--color-border-secondary);
border-radius:.6rem;
color:var(--color-text-primary);
transition:border-color var(--duration-fast), box-shadow var(--duration-fast);
}
input[type="range"]{width:100%; cursor:pointer}

.color-input-wrapper{position:relative}
.color-input-wrapper input[type="text"]{padding-right:2.8rem}
.color-picker-control{
position:absolute;
right:.35rem;
top:50%;
transform:translateY(-50%);
width:2rem;
height:2rem;
border:1px solid var(--color-border-secondary);
padding:0;
background:none;
border-radius:.45rem;
overflow:hidden;
cursor:pointer;
}
.input-with-button{display:flex; align-items:center; gap:.35rem}

:focus-visible{
outline:2px solid var(--color-focus-ring);
outline-offset:2px;
box-shadow:0 0 0 2px var(--color-bg-secondary), 0 0 0 4px var(--color-focus-ring)
}
input:focus-visible,select:focus-visible,.button:focus-visible,.icon-button:focus-visible,.drop-zone:focus-visible{
border-color:var(--color-accent-primary)
}

/* Tabs */
.tabs{display:flex; border-bottom:1px solid var(--color-border-primary); margin-bottom:1rem}
.tab-button{
flex:1;
min-height:var(--tap-min);
padding:.5rem 1rem;
font-size:.875rem;
font-weight:800;
background:none;
border:none;
border-bottom:2px solid transparent;
color:var(--color-text-muted);
cursor:pointer;
transition: color var(--duration-fast), border-color var(--duration-fast);
margin-bottom:-1px;
}
.tab-button:hover{color:var(--color-text-primary)}
.tab-button.active{color:var(--color-accent-primary); border-bottom-color:var(--color-accent-primary)}

/* ==========================================================================
6. APP-SPECIFIC
========================================================================== */
.drop-zone{
width:100%;
aspect-ratio:16/10;
background:var(--color-bg-secondary);
border:2px dashed var(--color-border-secondary);
border-radius:.75rem;
display:flex;
align-items:center;
justify-content:center;
text-align:center;
cursor:pointer;
transition: border-color var(--duration-medium), background var(--duration-medium);
position:relative;
overflow:hidden;
margin-bottom:1rem;
}
.drop-zone.drag-over{border-color:var(--color-accent-primary); background:var(--color-bg-tertiary)}
.drop-zone-placeholder{color:var(--color-text-muted); padding:0 .75rem}
.drop-zone-placeholder .icon{width:2rem; height:2rem; margin:0 auto .5rem}
.drop-zone-placeholder .link{color:var(--color-accent-primary); text-decoration:underline}

.image-preview{
position:absolute;
top:0; left:0;
width:100%; height:100%;
display:none;
}
.clear-image-btn{
position:absolute;
top:.35rem;
right:.35rem;
background:rgba(0,0,0,.4);
color:#fff
}
.clear-image-btn:hover{background:rgba(0,0,0,.6)}

.color-swatch{
position:relative;
border-radius:.75rem;
overflow:hidden;
display:flex;
flex-direction:column;
box-shadow:var(--shadow-small);
transition: transform var(--duration-medium), box-shadow var(--duration-medium);
border:2px solid transparent;
min-width:0;
}
.color-swatch.selected{border-color:var(--color-accent-primary)}
.color-swatch.dragging{opacity:.55; transform:scale(1.02); box-shadow:var(--shadow-large); z-index:var(--z-index-draggable)}
.color-swatch-display{
flex:1;
min-height:88px;
display:flex;
align-items:flex-end;
padding:.65rem;
color:var(--color-swatch-text);
cursor:pointer
}
.color-swatch-info{
background:var(--color-bg-secondary);
padding:.6rem .75rem;
border-top:1px solid var(--color-border-primary)
}
.color-name{
font-weight:800;
font-size:.9rem;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis
}
.color-code{
font-family:var(--font-mono);
font-size:.8rem;
color:var(--color-text-muted);
cursor:pointer
}
.color-swatch-actions{
position:absolute;
top:.5rem;
right:.5rem;
display:flex;
gap:.25rem;
opacity:0;
visibility:hidden;
transition:opacity var(--duration-fast), visibility var(--duration-fast)
}
.color-swatch:hover .color-swatch-actions,
.color-swatch:focus-within .color-swatch-actions{opacity:1; visibility:visible}

.color-swatch-actions .icon-button{
min-width:40px;
min-height:40px;
padding:.35rem;
background:rgba(0,0,0,.30);
color:#fff
}
.color-swatch-actions .icon-button:hover{background:rgba(0,0,0,.50)}

.lock-indicator{font-size:1rem}

.history-controls,.palette-main-actions{display:flex; gap:.5rem; flex-wrap:wrap}

.table-container{overflow:auto; max-height:320px; -webkit-overflow-scrolling:touch}
.contrast-grid{width:100%; border-collapse:collapse; font-size:.75rem}
.contrast-grid th,.contrast-grid td{padding:.4rem; text-align:center; border:1px solid var(--color-border-primary); min-width:44px}
.contrast-grid th{background:var(--color-bg-tertiary); font-weight:800; position:sticky; top:0}
.contrast-badge{
display:inline-block;
padding:.15rem .35rem;
border-radius:.35rem;
font-weight:900;
font-size:.65rem;
color:black;
line-height:1.1
}

.export-buttons{display:grid; grid-template-columns:1fr 1fr; gap:.5rem}
.editor-swatch-preview{
width:100%;
height:44px;
border-radius:.6rem;
margin-bottom:1rem;
border:1px solid var(--color-border-secondary)
}

/* Modale */
.modal-overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,.7);
display:flex;
align-items:center;
justify-content:center;
z-index:var(--z-index-modal);
opacity:0;
visibility:hidden;
transition:opacity var(--duration-medium), visibility var(--duration-medium)
}
.modal-overlay:not(.hidden){opacity:1; visibility:visible}
.modal-content{
background:var(--color-bg-secondary);
border-radius:.75rem;
padding:1.5rem;
width:92%;
max-width:560px;
box-shadow:var(--shadow-large);
transform:scale(.97);
transition:transform var(--duration-medium)
}
.modal-overlay:not(.hidden) .modal-content{transform:scale(1)}
.modal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem}
.shortcuts-list{list-style:none}
.shortcuts-list li{
display:flex;
justify-content:space-between;
align-items:center;
padding:.6rem 0;
border-bottom:1px solid var(--color-border-primary)
}
.shortcuts-list li:last-child{border:none}
.shortcuts-list kbd{
background:var(--color-bg-tertiary);
border:1px solid var(--color-border-secondary);
border-radius:.35rem;
padding:.15rem .45rem;
font-family:var(--font-mono);
font-size:.85rem;
margin-left:.25rem
}

/* ==========================================================================
7. UTILITY & ACCESSIBILITY
========================================================================== */
.sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.hidden{display:none !important}
.icon{width:1.2em; height:1.2em; vertical-align:-.2em}
.empty-state{text-align:center; color:var(--color-text-muted); padding:2rem 1rem; font-size:.875rem}
.empty-state-full{
grid-column:1 / -1;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:100%;
color:var(--color-text-muted);
text-align:center
}
.icon-large{width:3rem; height:3rem; margin-bottom:1rem}

/* Snackbar */
.snackbar{
position:fixed;
left:50%;
bottom: calc(16px + env(safe-area-inset-bottom));
transform:translateX(-50%) translateY(16px);
background:var(--color-bg-secondary);
color:var(--color-text-primary);
border:1px solid var(--color-border-primary);
border-radius:999px;
padding:.6rem .95rem;
box-shadow:var(--shadow-medium);
opacity:0;
pointer-events:none;
transition:opacity var(--duration-medium), transform var(--duration-medium);
z-index:var(--z-index-toast);
max-width:min(92vw, 720px);
text-align:center;
}
.snackbar.show{opacity:1; transform:translateX(-50%) translateY(0)}
.snackbar.danger{background:#fee2e2; border-color:#fecaca; color:#7f1d1d}

@media (prefers-reduced-motion: reduce){
*,*::before,*::after{
animation-duration:.01ms !important;
animation-iteration-count:1 !important;
transition-duration:.01ms !important;
scroll-behavior:auto !important
}
}
